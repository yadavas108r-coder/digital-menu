<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Barf Malai Admin Panel</title>
  <style>
    body {font-family: 'Poppins', sans-serif; background:#fafafa; margin:0; padding:0;}
    header {background:#ff6b6b; color:white; padding:15px; text-align:center; font-size:22px;}
    .container {max-width:900px; margin:30px auto; background:white; border-radius:10px; box-shadow:0 3px 10px rgba(0,0,0,0.1); padding:20px;}
    h2 {border-left:5px solid #ff6b6b; padding-left:10px;}
    form {margin:15px 0;}
    input, select {padding:8px; margin:5px 0; width:100%; border:1px solid #ccc; border-radius:6px;}
    button {background:#ff6b6b; color:white; border:none; padding:10px 16px; border-radius:6px; cursor:pointer;}
    button:hover {background:#ff5050;}
    table {width:100%; border-collapse:collapse; margin-top:15px;}
    th, td {border:1px solid #ddd; padding:8px; text-align:left;}
    th {background:#ffefef;}
    .success {color:green;}
    .error {color:red;}
  </style>
</head>
<body>
  <header>üç¶ Barf Malai Admin Panel</header>
  <div class="container">

    <h2>Add Category</h2>
    <form id="addCategoryForm">
      <input type="text" id="catName" placeholder="Category Name" required>
      <input type="file" id="catImage" accept="image/*" required>
      <button type="submit">Upload Category</button>
    </form>
    <div id="catMsg"></div>

    <hr>

    <h2>Add Menu Item</h2>
    <form id="addMenuForm">
      <input type="text" id="itemName" placeholder="Item Name" required>
      <input type="number" id="itemPrice" placeholder="Price" required>
      <input type="text" id="itemDescription" placeholder="Description">
      <select id="itemCategory" required></select>
      <input type="file" id="itemImage" accept="image/*" required>
      <select id="itemType">
        <option value="veg">Veg</option>
        <option value="non-veg">Non-Veg</option>
      </select>
      <button type="submit">Add Menu Item</button>
    </form>
    <div id="menuMsg"></div>

    <hr>
    <h2>Current Categories</h2>
    <table id="catTable">
      <thead><tr><th>Name</th><th>Image</th></tr></thead>
      <tbody></tbody>
    </table>

  </div>

<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycbytm_qmrzbJljoueecFK8_F-yBiU3evpeU4NWVl6_tCkvtiG_jCoHSE4xlS1RxDoCpe/exec";

// ---- CATEGORY UPLOAD ----
document.getElementById("addCategoryForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const msg = document.getElementById("catMsg");
  const name = document.getElementById("catName").value.trim();
  const file = document.getElementById("catImage").files[0];
  if(!name || !file) return alert("Please fill all fields");

  const fd = new FormData();
  fd.append("action","uploadCategory");
  fd.append("name",name);
  fd.append("file",file);
  msg.innerHTML="‚è≥ Uploading...";

  try{
    const res = await fetch(SHEET_URL,{method:"POST",body:fd});
    const data = await res.json();
    if(data.success){
      msg.innerHTML = "<span class='success'>‚úÖ Category added successfully</span>";
      document.getElementById("addCategoryForm").reset();
      loadCategories();
    }else msg.innerHTML = "<span class='error'>‚ùå "+data.error+"</span>";
  }catch(err){
    msg.innerHTML = "<span class='error'>‚ùå Upload failed</span>";
  }
});

// ---- MENU ITEM UPLOAD ----
document.getElementById("addMenuForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const msg = document.getElementById("menuMsg");
  const name = itemName.value.trim();
  const price = itemPrice.value.trim();
  const desc = itemDescription.value.trim();
  const cat = itemCategory.value;
  const type = itemType.value;
  const file = itemImage.files[0];
  if(!name || !price || !cat || !file) return alert("Fill all required fields");

  const fd = new FormData();
  fd.append("action","uploadMenuItem");
  fd.append("name",name);
  fd.append("price",price);
  fd.append("desc",desc);
  fd.append("category",cat);
  fd.append("type",type);
  fd.append("file",file);
  msg.innerHTML="‚è≥ Uploading...";

  try{
    const res = await fetch(SHEET_URL,{method:"POST",body:fd});
    const data = await res.json();
    if(data.success){
      msg.innerHTML = "<span class='success'>‚úÖ Menu item added successfully</span>";
      document.getElementById("addMenuForm").reset();
    }else msg.innerHTML = "<span class='error'>‚ùå "+data.error+"</span>";
  }catch(err){
    msg.innerHTML = "<span class='error'>‚ùå Upload failed</span>";
  }
});

// ---- LOAD CATEGORIES INTO MENU FORM ----
async function loadCategories(){
  try{
    const res = await fetch(SHEET_URL+"?action=getCategories");
    const data = await res.json();
    const select = document.getElementById("itemCategory");
    const tbody = document.querySelector("#catTable tbody");
    select.innerHTML="";
    tbody.innerHTML="";
    data.forEach(c=>{
      const opt = document.createElement("option");
      opt.value=c.name;
      opt.textContent=c.name;
      select.appendChild(opt);
      const tr = document.createElement("tr");
      tr.innerHTML=`<td>${c.name}</td><td><img src="${c.image}" width="60"></td>`;
      tbody.appendChild(tr);
    });
  }catch(err){console.error(err);}
}
loadCategories();
</script>
</body>
</html>
